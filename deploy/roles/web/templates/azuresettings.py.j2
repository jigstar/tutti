"""Production specific settings for Azure virtual machine deployment."""

from tutti.settings import *  # noqa: F403

DEBUG = False

# Secret key & PostgreSQL database password
# These secrets are randomly generated by the deployment script.
SECRET_KEY = '{{ secret_key }}'

DATABASES['default'] = {  # noqa: F405
    'ENGINE': 'django.db.backends.postgresql',
    'NAME': 'tutti',
    'USER': 'tutti',
    'HOST': 'localhost',
    'PASSWORD': '{{ db_password }}',
    'CONN_MAX_AGE': 3600,
}

# E-mail configuration
# Using the G Suite relay service we can send mails from @esmgquadrivium.nl.
# Authentication works via IP address, thus it only works on the production server.
EMAIL_BACKEND = 'django.core.mail.backends.smtp.EmailBackend'
EMAIL_HOST = 'smtp-relay.gmail.com'
EMAIL_PORT = 587
EMAIL_USE_TLS = True
SERVER_EMAIL = 'info@esmgquadrivium.nl'
DEFAULT_FROM_EMAIL = 'info@esmgquadrivium.nl'
ADMINS = [('Maarten Visscher', 'sysop@esmgquadrivium.nl')]

ALLOWED_HOSTS = ['{{ server_name }}']

STATIC_ROOT = '{{ static_path }}'
MEDIA_ROOT = '{{ media_path }}'

# HTTPS
CSRF_COOKIE_SECURE = True
SESSION_COOKIE_SECURE = True

# Keycloak OpenID Connect client secret
AUTHLIB_OAUTH_CLIENTS['keycloak']['client_secret'] = '{{ keycloak_client_secret }}'

# LDAP login configuration
LDAP['USER'] = 'cn=Tutti,ou=Special Users,dc=esmgquadrivium,dc=nl'
LDAP['PASSWORD'] = '{{ ldap_password }}'

# Version info
from datetime import date
# noinspection PyTypeChecker,PyUnresolvedReferences
VERSION_DATE = date(int('{{ ansible_date_time.year }}'), int('{{ ansible_date_time.month }}'),
                    int('{{ ansible_date_time.day }}'))
VERSION_URL = 'https://github.com/mhvis/tutti/commits/{{ git_branch }}'
